<!DOCTYPE html>
<html ng-app="Feedback">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <title>Feedback</title>
    <link rel="stylesheet" href="css/bootstrap.min.css"/>
    <link rel="stylesheet" href="css/font-awesome.min.css"/>
    <link rel="stylesheet" href="css/vis.min.css"/>
    <link rel="stylesheet" href="css/main.css"/>
    <link rel="shortcut icon" href="gpx/favicon.ico" type="image/x-icon">
    <script src="libs/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=marker,geometry,places&key=AIzaSyA1f6WHaRzT4X3oh9t_VXFvmBcr3coP0sg"></script>
    <script src="libs/vis.min.js"></script>
    <script src="libs/jquery.textcomplete.min.js"></script>
    <script src="libs/linkify.min.js"></script>
    <script src="libs/linkify-html.min.js"></script>
    <script src="libs/angular.min.js"></script>
    <script src="libs/ui-bootstrap-tpls-1.1.2.min.js"></script>
    <script src="../socket.io/socket.io.js"></script>
    <script src="js/app.js"></script>
</head>
<body>
<div class="main-container" ng-controller="FeedbackController">

    <div class="row top-bar">
        <div class="col-xs-4 logowithname">
            <img src="gpx/logo.png" alt="LOGO" class="logo"/>
            <strong class="session-title" ng-bind="sesinfo.name"></strong>
        </div>
        <div class="col-xs-8">
            <div class="btn-group hidden-xs pull-right">
                <div uib-dropdown class="btn-group spatiated-hz">
                    <button uib-dropdown-toggle class="btn btn-default">
                        Active Users ({{connectedUsers.length}}) <span class="caret"></span>
                    </button>
                    <ul uib-dropdown-menu>
                        <li ng-repeat="user in connectedUsers">
                            <a class="dropdown-item" href="">{{ user.uname }}</a>
                        </li>
                    </ul>
                </div>
                <button class="btn btn-default spatiated-hz" ng-disabled="feeds.length >= 200" ng-click="openTwitterModal()"><span ng-if="feeds.length < 200"><i class="fa fa-twitter"></i> Search Tweets</span><span ng-if="feeds.length >= 200"><i class="fa fa-twitter"></i>Tweet limit reached</span></button>
                <button class="btn btn-default spatiated-hz" ng-click="getHistorySearches()" ng-class="{'active':historyOpened}"><i class="fa fa-clock-o"> History</i></button>
                <!--
                <button class="btn btn-default spatiated-hz" ng-click="toggleFeeds()" ng-class="{'active':feedsOpened}"><i class="fa fa-comments-o"></i> Tweets</button>
                <button class="btn btn-default spatiated-hz" ng-click="openDisChat()" ng-class="{'active':chatOpened}"><i class="fa fa-comments"></i> Discussion</button>
                -->
                <a class="btn btn-default spatiated-hz" href="profile"><i class="fa fa-user"></i> Profile</a>
                <a class="btn btn-default spatiated-hz" href="seslist"><i class="fa fa-chevron-left"></i> Change Session</a></li>
                <a class="btn btn-default spatiated-hz" href="logout"><i class="fa fa-sign-out"></i> Log out</a>
            </div>
            <div class="visible-xs-block pull-right">
                <button type="button" class="bar-menu-toggle" ng-click="isCollapsed = !isCollapsed">
                    <i class="fa fa-bars" aria-hidden="true"></i>
                </button>
            </div>
            <div class="btn-group-vertical top-bar-vertical" ng-if="isCollapsed">
                <div uib-dropdown class="btn-group spatiated-hz">
                    <button uib-dropdown-toggle class="btn btn-default">
                        Active Users ({{connectedUsers.length}}) <span class="caret"></span>
                    </button>
                    <ul uib-dropdown-menu>
                        <li ng-repeat="user in connectedUsers">
                            <a class="dropdown-item" href="">{{ user.uname }}</a>
                        </li>
                    </ul>
                </div>
                <button class="btn btn-default spatiated-hz" ng-disabled="feeds.length >= 200" ng-click="openTwitterModal()"><span ng-if="feeds.length < 200"><i class="fa fa-twitter"></i> Search Tweets</span><span ng-if="feeds.length >= 200"><i class="fa fa-twitter"></i>Tweet limit reached</span></button>
                <button class="btn btn-default spatiated-hz" ng-click="getHistorySearches()" ng-class="{'active':historyOpened}"><i class="fa fa-clock-o"> History</i></button>
                <!--
                <button class="btn btn-default spatiated-hz" ng-click="toggleFeeds()" ng-class="{'active':feedsOpened}"><i class="fa fa-comments-o"></i> Tweets</button>
                <button class="btn btn-default spatiated-hz" ng-click="openDisChat()" ng-class="{'active':chatOpened}"><i class="fa fa-comments"></i> Discussion</button>
                -->
                <a class="btn btn-default spatiated-hz" href="seslist"><i class="fa fa-chevron-left"></i> Change Session</a></li>
                <a class="btn btn-default spatiated-hz" href="logout"><i class="fa fa-sign-out"></i> Log out</a>
            </div>
        </div>
    </div>
    

    <div class="row abs-full-height">
        <div class="full-height flex-column resizable-hor feeds-container" ng-class="{'col-sm-3': chatOpened,
                    'col-sm-4': !chatOpened}" ng-show="feedsOpened">
            <!--
            <div class="simple-padding" ng-controller="NewFeedController">
                <span class="label label-primary over-right" ng-class="{'label-danger':newFeed.com.length>140}">{{newFeed.com.length}}</span>
                <textarea id="new-feed-box" class="form-control" rows="3" ng-model="newFeed.com"></textarea>
                <div class="btn-group btn-group-justified">
                    <a class="btn btn-default full-width disabled"><i class="fa fa-picture-o"></i> Add Media</a>
                    <a class="btn btn-success" ng-disabled="newFeed.com.length>140 || newFeed.com.length<1" ng-click="publishFeed()">
                        <i class="fa fa-edit"></i> Publish
                    </a>
                </div>
            </div>
            <hr/>
            -->
            <div class="input-group" ng-controller="SearchController">
                <input type="text" class="form-control" ng-model="simpleSearchBox" ng-keypress="($event.which === 13)?simpleSearch():0" placeholder="Filter tweets by word"/>
                <span class="input-group-btn">
                    <button class="btn btn-default" ng-click="simpleSearch()"><i class="fa fa-search"></i></button>
                    <button class="btn btn-default" ng-click="restoreFeeds()"><i class="fa fa-times"></i></button>
                    <button class="btn btn-default" uib-popover-template="'templ/popover_search.html'" popover-placement="bottom-right" popover-is-open="advSearchOpen" ng-click="openAdvSearch()">
                        <i class="fa fa-sliders"></i>
                    </button>
                </span>
            </div>
            <button class="btn btn-default" ng-click="onlyhighlights()"><span>{{onlyHighFeeds ? 'See all tweets ('+feeds.length+')' : 'See selected tweets ('+selectedFeeds.length+')'}}</span></button>
            <div class="simple-padding feeds-list scrollable" ng-if="onlyHighFeeds">
                <div ng-if="highlights.length === 0">
                    No highlighted tweets
                </div>
                <div class="feed-box" ng-repeat="feed in feeds" ng-class="{highlight:(highlights.includes(feed.id))}" ng-if="highlights.includes(feed.id)">
                    <div class="row">
                        <span class="col-xs-1"><strong> {{feed.order}}.</strong></span>
                        <span class="col-xs-5"><strong>{{getUsername(feed)}}</strong></span>
                        <span class="col-xs-6"><span class="pull-right gray">{{feed.time | date:'d-MM-yyyy HH:mm'}}</span></span>
                    </div>
                    <span class="feed-text" bind-html-compile="feed.prettyText"></span>
                    <span class="extra-box" ng-show="feed.extra!=null">
                        <a ng-click="shared.referenceMsg(feed.order)" class="text-primary">Reference message in chat.</a>
                        <br>
                        By <a href="https://twitter.com/{{feed.extra.split('|')[1].substring(1)}}" target="_blank">{{feed.extra.split("|")[1]}}</a> -
                        <a href="https://twitter.com/{{feed.extra.split('|')[1].substring(1)}}/status/{{feed.extra.split('|')[0]}}" target="_blank">
                            <i class="fa fa-twitter"></i> View original tweet</a>
                    </span>
                </div>
            </div>
            <div class="simple-padding feeds-list scrollable" ng-if="!onlyHighFeeds">
                <div ng-if="feeds.length === 0">
                    No tweets available
                </div>
                <div class="feed-box" ng-repeat="feed in feeds" ng-class="{highlight:(highlights.includes(feed.id))}" ng-click="highlightUnique(feed.id)">
                    <div class="row">
                        <span class="col-xs-1"><strong> {{feed.order}}.</strong></span>
                        <span class="col-xs-5"><strong>{{getUsername(feed)}}</strong></span>
                        <span class="col-xs-6"><span class="pull-right gray">{{feed.time | date:'d-MM-yyyy HH:mm'}}</span></span>
                    </div>
                    <span class="feed-text" bind-html-compile="feed.prettyText"></span>
                    <span class="extra-box" ng-show="feed.extra!=null && highlights.length==1">
                        <a ng-click="shared.referenceMsg(feed.order)" class="text-primary">Reference message in chat.</a>
                        <br>
                        By <a href="https://twitter.com/{{feed.extra.split('|')[1].substring(1)}}" target="_blank">{{feed.extra.split("|")[1]}}</a> -
                        <a href="https://twitter.com/{{feed.extra.split('|')[1].substring(1)}}/status/{{feed.extra.split('|')[0]}}" target="_blank">
                            <i class="fa fa-twitter"></i> View original tweet</a>
                    </span>
                </div>
            </div>
        </div>
        <div class="flex-column" ng-class="{'col-sm-12': !chatOpened && !feedsOpened, 'col-sm-7': chatOpened && !feedsOpened,
            'col-sm-8': !chatOpened && feedsOpened, 'col-sm-6': feedsOpened && chatOpened}">
            <div class="flex-element-mid resizable-ver" ng-controller="MapController">
                <div id="map"></div>
                <div class="markerPanel" ng-if="selectedMarker">
                    <a class="btn btn-default btn-xs" style="align-self: flex-end;" ng-click="closeInfoPanel()"><i class="fa fa-times"></i></a>
                    <!--
                    <div>Coordinates: {{selectedMarker.coords.lat()}},{{selectedMarker.coords.lng()}}</div>
                    -->
                    <div>Location: {{selectedMarker.address}}</div>    
                    <div>Tweets in this location: {{selectedMarker.fids.length}}</div>
                    <button class="btn btn-default btn-xs" ng-click="shared.referencePlace(selectedMarker.coords.lat(), selectedMarker.coords.lng())">Reference place in chat</button>
                </div>
                <!--
                <div id="mapctrl">
                    <a class="map-btn" id="markbtn">Place marker</a>
                </div>
                -->
                <input type="text" id="pac-input">
            </div>
            <div class="flex-element-mid resizable-ver" ng-controller="GraphController">
                <div id="graph"></div>
                <div class="graph-ov-btn graph-descr" ng-show="detailBox.show">
                    <a class="btn btn-white btn-xs" ng-show="detailBox.expandible" ng-click="appendCat()"><i class="fa fa-expand"></i></a>
                    <a class="btn btn-white btn-xs" ng-show="detailBox.expandible" ng-click="searchFromTw()"><i class="fa fa-twitter"></i></a>
                    <a class="btn btn-white btn-xs" ng-show="!detailBox.expandible" ng-click="removeItem()"><i class="fa fa-trash"></i></a>
                </div>
                <div class="graph-ov-btn graph-zoom">
                    <a class="btn btn-white btn-xs" ng-click="graphCenter()"><i class="fa fa-compass"></i></a>
                    <hr/>
                    <a class="btn btn-white btn-xs" ng-click="graphZoom(3/2)"><i class="fa fa-plus"></i></a>
                    <hr/>
                    <a class="btn btn-white btn-xs" ng-click="graphZoom(2/3)"><i class="fa fa-minus"></i></a>
                </div>
            </div>
        </div>
        <div class="flex-column resizable-hor discussion-container" ng-class="{'col-sm-3': feedsOpened,
             'col-sm-5': !feedsOpened}" ng-show="chatOpened" ng-controller="ChatController">
            <div>
                <button class="btn btn-default" ng-click="changeChat('chat')"><i class="fa fa-comments"></i> Chat</button>
                <div uib-dropdown class="btn-group spatiated-hz">
                    <button uib-dropdown-toggle class="btn btn-default">
                        Common tweets analysis <span class="caret"></span>
                    </button>
                    <ul uib-dropdown-menu>
                        <li>
                            <a class="dropdown-item" ng-click="changeChat('insight')"><i class="fa fa-lightbulb-o"></i> Insights</a>
                        </li>
                        <li>
                            <a class="dropdown-item" ng-click="changeChat('sentiment')"><i class="fa fa-heart"></i> Sentiments</a>
                        </li>
                        <li>
                            <a class="dropdown-item" ng-click="changeChat('stance')"><i class="fa fa-balance-scale"></i> Stances</a>
                        </li>
                    </ul>
                </div>
                <!--
                <button class="btn btn-default" ng-click="changeChat('insight')"><i class="fa fa-lightbulb-o"></i> Insight</button>
                <button class="btn btn-default" ng-click="changeChat('sentiment')"><i class="fa fa-heart"></i> Sentiment</button>
                <button class="btn btn-default" ng-click="changeChat('stance')"><i class="fa fa-balance-scale"></i> Stance</button>
                -->
            </div>
            <div class="flex-element" ng-show="modes['chat'][1]">
                <h4 class="chat-header"><i class="fa fa-comments"></i> Chat</h4>
                <p>Chat with other active users or ask @bot to help you analyse tweets!
                    If you have selected tweets from the list, @bot will answer using 
                    that info. Deselect all tweets so @bot uses the entire list. 
                </p>
                <div class="chat-container scrollable" id="chatbox">
                    <div class="chat-box" ng-repeat="chat in chatMsgs">
                        <strong ng-bind="chat.author"></strong>
                        <div class="chat-message" bind-html-compile="chat.prettyContent"></div>
                    </div>               
                </div>
                <div ng-show="isThinking" class="thinking-text">
                    <strong>Assistant is thinking...</strong>
                </div> 
                <div class="input-group chat-input">
                    <textarea class="form-control" ng-model="newMsg" placeholder="Write a message... Messages to the assistant must start with '@bot'" ng-keydown="checkEnter($event)"></textarea>
                    <a class="input-group-addon btn btn-default" ng-click="sendChatMsg()">
                        <i class="fa fa-send"></i>
                    </a>
                </div>
            </div>
            <div class="flex-element" ng-show="modes['insight'][1]">
                <div style="display: flex; align-items: center;">
                    <h4 class="chat-header"><i class="fa fa-lightbulb-o"></i> Insights</h4>
                    <button class="btn btn-default" ng-click="getInfo('insight')">Get Tweet Insights</button>
                </div>
                <p>Get Insights from the list of tweets!</p>
                <div class="chat-container scrollable">
                    <p class="bot-info" ng-if="modes['insight'][0] == ''">No insights available. Press above to get.</p>
                    <div class="bot-info" bind-html-compile="modes['insight'][0]"></div>
                </div>
            </div>
            <div class="flex-element" ng-show="modes['sentiment'][1]">
                <div style="display: flex; align-items: center;">
                    <h4 class="chat-header"><i class="fa fa-heart"></i> Sentiments</h4>
                    <button class="btn btn-default" ng-click="getInfo('sentiment')">Get Tweet Sentiments</button>
                </div>
                <p>Do sentiment analysis of the tweets! (happiness, anger, fear, disgust, sadness, surprise)</p>
                <div class="chat-container scrollable">
                    <p class="bot-info" ng-if="modes['sentiment'][0] == ''">No sentiments available. Press above to get.</p>
                    <div class="bot-info" bind-html-compile="modes['sentiment'][0]"></div>
                </div>
            </div>
            <div class="flex-element" ng-show="modes['stance'][1]">
                <div style="display: flex; align-items: center;">
                    <h4 class="chat-header"><i class="fa fa-balance-scale"></i> Stances</h4>
                    <button class="btn btn-default" ng-click="getInfo('stance')">Get Tweet Stances</button>
                </div>
                <p>Identify tweet stances! (positive, negative, neutral)</p>
                <div class="chat-container scrollable">
                    <p class="bot-info" ng-if="modes['stance'][0] == ''">No stances available. Press above to get.</p>
                    <div class="bot-info" bind-html-compile="modes['stance'][0]"></div>
                </div>
            </div>
        </div>
    </div>


</div>
</body>
</html>
